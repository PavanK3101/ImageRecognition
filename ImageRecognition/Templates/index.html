HTML_TEMPLATE = """<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Image Recognition System</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">    <style>        .gradient-bg {            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            color: white;        }        .card-hover:hover {            transform: translateY(-5px);            transition: all 0.3s ease;        }        .prediction-card {            border-left: 4px solid #667eea;        }        .upload-area {            border: 2px dashed #667eea;            border-radius: 10px;            padding: 2rem;            text-align: center;            cursor: pointer;            transition: all 0.3s ease;        }        .upload-area:hover {            background-color: #f8f9fa;            border-color: #5a67d8;        }        .upload-area.dragover {            background-color: #e6f3ff;            border-color: #0066cc;        }        .progress-bar {            height: 6px;        }        .confidence-bar {            height: 20px;            background: linear-gradient(90deg, #28a745 0%, #ffc107 70%, #dc3545 100%);        }        .image-preview {            max-width: 100%;            max-height: 400px;            border-radius: 10px;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);        }        .feature-badge {            font-size: 0.8rem;            margin: 2px;        }        .loading-spinner {            display: none;        }        .prediction-item {            animation: fadeInUp 0.5s ease;        }        @keyframes fadeInUp {            from {                opacity: 0;                transform: translateY(20px);            }            to {                opacity: 1;                transform: translateY(0);            }        }    </style></head><body>    <!-- Header -->    <nav class="navbar navbar-expand-lg gradient-bg">        <div class="container">            <a class="navbar-brand" href="#">                <i class="fas fa-camera-retro me-2"></i>                Image Recognition System            </a>            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">                <span class="navbar-toggler-icon"></span>            </button>            <div class="collapse navbar-collapse" id="navbarNav">                <ul class="navbar-nav ms-auto">                    <li class="nav-item">                        <a class="nav-link" href="#" onclick="showModelInfo()">                            <i class="fas fa-info-circle me-1"></i>Model Info                        </a>                    </li>                    <li class="nav-item">                        <a class="nav-link" href="#" onclick="showBatchUpload()">                            <i class="fas fa-images me-1"></i>Batch Upload                        </a>                    </li>                </ul>            </div>        </div>    </nav>    <!-- Main Content -->    <div class="container mt-4">        <div class="row">            <!-- Upload Section -->            <div class="col-lg-6 mb-4">                <div class="card h-100 card-hover">                    <div class="card-header gradient-bg">                        <h5 class="mb-0">                            <i class="fas fa-upload me-2"></i>Upload Image                        </h5>                    </div>                    <div class="card-body">                        <!-- File Upload -->                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">                            <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>                            <h5>Drop files here or click to browse</h5>                            <p class="text-muted">Supported formats: JPG, PNG, GIF, BMP, WEBP</p>                            <input type="file" id="fileInput" accept="image/*" style="display: none;">                        </div>                                                <!-- URL Input -->                        <div class="mt-3">                            <div class="input-group">                                <input type="url" class="form-control" id="imageUrl" placeholder="Or enter image URL">                                <button class="btn btn-outline-primary" type="button" onclick="predictFromUrl()">                                    <i class="fas fa-link me-1"></i>Predict                                </button>                            </div>                        </div>                                                <!-- Progress Bar -->                        <div class="mt-3">                            <div class="progress" style="display: none;" id="progressBar">                                <div class="progress-bar progress-bar-striped progress-bar-animated"                                      role="progressbar" style="width: 0%"></div>                            </div>                        </div>                                                <!-- Loading Spinner -->                        <div class="text-center mt-3 loading-spinner" id="loadingSpinner">                            <div class="spinner-border text-primary" role="status">                                <span class="visually-hidden">Loading...</span>                            </div>                            <p class="mt-2">Processing image...</p>                        </div>                    </div>                </div>            </div>            <!-- Results Section -->            <div class="col-lg-6 mb-4">                <div class="card h-100">                    <div class="card-header gradient-bg">                        <h5 class="mb-0">                            <i class="fas fa-chart-bar me-2"></i>Prediction Results                        </h5>                    </div>                    <div class="card-body" id="resultsContainer">                        <div class="text-center text-muted">                            <i class="fas fa-image fa-3x mb-3"></i>                            <h5>No predictions yet</h5>                            <p>Upload an image to see AI predictions</p>                        </div>                    </div>                </div>            </div>        </div>        <!-- Image Preview Section -->        <div class="row mt-4" id="imagePreviewSection" style="display: none;">            <div class="col-12">                <div class="card">                    <div class="card-header">                        <h5 class="mb-0">                            <i class="fas fa-eye me-2"></i>Image Preview & Analysis                        </h5>                    </div>                    <div class="card-body text-center">                        <img id="imagePreview" class="image-preview" alt="Preview">                        <div class="mt-3" id="imageFeatures"></div>                    </div>                </div>            </div>        </div>    </div>    <!-- Modal for Model Info -->    <div class="modal fade" id="modelInfoModal" tabindex="-1">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header gradient-bg">                    <h5 class="modal-title">Model Information</h5>                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>                </div>                <div class="modal-body" id="modelInfoContent">                    <div class="text-center">                        <div class="spinner-border text-primary" role="status">                            <span class="visually-hidden">Loading...</span>                        </div>                    </div>                </div>            </div>        </div>    </div>    <!-- Scripts -->    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>    <script>        // File upload handling        document.getElementById('fileInput').addEventListener('change', function(e) {            const file = e.target.files[0];            if (file) {                uploadFile(file);            }        });        // Drag and drop handling        const uploadArea = document.getElementById('uploadArea');                uploadArea.addEventListener('dragover', function(e) {            e.preventDefault();            uploadArea.classList.add('dragover');        });        uploadArea.addEventListener('dragleave', function(e) {            e.preventDefault();            uploadArea.classList.remove('dragover');        });        uploadArea.addEventListener('drop', function(e) {            e.preventDefault();            uploadArea.classList.remove('dragover');            const files = e.dataTransfer.files;            if (files.length > 0) {                uploadFile(files[0]);            }        });        // Upload file function        function uploadFile(file) {            const formData = new FormData();            formData.append('file', file);                        // Show loading state            showLoading(true);                        fetch('/upload', {                method: 'POST',                body: formData            })            .then(response => response.json())            .then(data => {                showLoading(false);                if (data.success) {                    displayResults(data);                    showImagePreview(data.image_url, data.features);                } else {                    showError(data.error);                }            })            .catch(error => {                showLoading(false);                showError('Upload failed: ' + error.message);            });        }        // Predict from URL        function predictFromUrl() {            const url = document.getElementById('imageUrl').value;            if (!url) {                showError('Please enter an image URL');                return;            }                        showLoading(true);                        fetch('/predict_url', {                method: 'POST',                headers: {                    'Content-Type': 'application/json',                },                body: JSON.stringify({url: url})            })            .then(response => response.json())            .then(data => {                showLoading(false);                if (data.success) {                    displayResults(data);                    showImagePreview(data.image_url, data.features);                } else {                    showError(data.error);                }            })            .catch(error => {                showLoading(false);                showError('Prediction failed: ' + error.message);            });        }        // Display prediction results        function displayResults(data) {            const container = document.getElementById('resultsContainer');                        if (data.predictions && data.predictions.length > 0) {                let html = '<h6 class="mb-3">Top Predictions:</h6>';                                data.predictions.forEach((prediction, index) => {                    const confidenceColor = prediction.confidence > 0.8 ? 'success' :                                           prediction.confidence > 0.5 ? 'warning' : 'danger';                                        html += `                        <div class="prediction-item mb-3">                            <div class="d-flex justify-content-between align-items-center mb-1">                                <span class="fw-bold">${prediction.class}</span>                                <span class="badge bg-${confidenceColor}">${prediction.percentage.toFixed(1)}%</span>                            </div>                            <div class="progress mb-2" style="height: 10px;">                                <div class="progress-bar bg-${confidenceColor}"                                      style="width: ${prediction.percentage}%"></div>                            </div>                        </div>                    `;                });                                container.innerHTML = html;            } else {                container.innerHTML = `                    <div class="text-center text-muted">                        <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>                        <h6>No confident predictions</h6>                        <p>The model couldn't identify objects with sufficient confidence</p>                    </div>                `;            }        }        // Show image preview and features        function showImagePreview(imageUrl, features) {            const section = document.getElementById('imagePreviewSection');            const preview = document.getElementById('imagePreview');            const featuresDiv = document.getElementById('imageFeatures');                        preview.src = imageUrl;            section.style.display = 'block';                        // Display image features            if (features) {                let featuresHtml = '<h6 class="mb-3">Image Analysis:</h6><div class="row">';                                featuresHtml += `                    <div class="col-md-6">                        <span class="badge bg-primary feature-badge">                            <i class="fas fa-expand-arrows-alt me-1"></i>                            ${features.width} × ${features.height}                        </span>                        <span class="badge bg-info feature-badge">                            <i class="fas fa-layer-group me-1"></i>                            ${features.channels} channels                        </span>                    </div>                    <div class="col-md-6">                        <span class="badge bg-warning feature-badge">                            <i class="fas fa-sun me-1"></i>                            Brightness: ${features.brightness ? features.brightness.toFixed(1) : 'N/A'}                        </span>                        <span class="badge bg-secondary feature-badge">                            <i class="fas fa-adjust me-1"></i>                            Contrast: ${features.contrast ? features.contrast.toFixed(1) : 'N/A'}                        </span>                    </div>                `;                                featuresHtml += '</div>';                featuresDiv.innerHTML = featuresHtml;            }        }        // Show loading state        function showLoading(show) {            const spinner = document.getElementById('loadingSpinner');            const progressBar = document.getElementById('progressBar');                        if (show) {                spinner.style.display = 'block';                progressBar.style.display = 'block';                // Animate progress bar                const bar = progressBar.querySelector('.progress-bar');                bar.style.width = '0%';                setTimeout(() => bar.style.width = '100%', 100);            } else {                spinner.style.display = 'none';                progressBar.style.display = 'none';            }        }        // Show error message        function showError(message) {            const container = document.getElementById('resultsContainer');            container.innerHTML = `                <div class="alert alert-danger" role="alert">                    <i class="fas fa-exclamation-triangle me-2"></i>                    ${message}                </div>            `;        }        // Show model info modal        function showModelInfo() {            const modal = new bootstrap.Modal(document.getElementById('modelInfoModal'));            modal.show();                        fetch('/model_info')            .then(response => response.json())            .then(data => {                const content = document.getElementById('modelInfoContent');                                if (data.error) {                    content.innerHTML = `                        <div class="alert alert-danger">                            <i class="fas fa-exclamation-triangle me-2"></i>                            ${data.error}                        </div>                    `;                } else {                    let html = `                        <div class="row">                            <div class="col-md-6">                                <h6><i class="fas fa-brain me-2"></i>Model Details</h6>                                <p><strong>Name:</strong> ${data.model_name}</p>                                <p><strong>Classes:</strong> ${data.num_classes}</p>                                <p><strong>Input Size:</strong> ${data.image_size[0]}×${data.image_size[1]}</p>                                <p><strong>Confidence Threshold:</strong> ${(data.confidence_threshold * 100).toFixed(1)}%</p>                            </div>                            <div class="col-md-6">                                <h6><i class="fas fa-tags me-2"></i>Supported Classes</h6>                                <div class="d-flex flex-wrap">                    `;                                        data.classes.forEach(className => {                        html += `<span class="badge bg-light text-dark m-1">${className}</span>`;                    });                                        html += `                                </div>                            </div>                        </div>                    `;                                        content.innerHTML = html;                }            })            .catch(error => {                document.getElementById('modelInfoContent').innerHTML = `                    <div class="alert alert-danger">                        <i class="fas fa-exclamation-triangle me-2"></i>                        Error loading model info: ${error.message}                    </div>                `;            });        }        // Show batch upload modal        function showBatchUpload() {            // Create batch upload modal dynamically            const modalHtml = `                <div class="modal fade" id="batchUploadModal" tabindex="-1">                    <div class="modal-dialog modal-lg">                        <div class="modal-content">                            <div class="modal-header gradient-bg">                                <h5 class="modal-title">                                    <i class="fas fa-images me-2"></i>Batch Upload                                </h5>                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>                            </div>                            <div class="modal-body">                                <div class="upload-area" id="batchUploadArea">                                    <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>                                    <h5>Drop multiple images here or click to browse</h5>                                    <p class="text-muted">Select multiple images for batch processing</p>                                    <input type="file" id="batchFileInput" multiple accept="image/*" style="display: none;">                                </div>                                <div class="mt-3" id="batchResults"></div>                            </div>                        </div>                    </div>                </div>            `;                        // Remove existing modal if any            const existingModal = document.getElementById('batchUploadModal');            if (existingModal) {                existingModal.remove();            }                        // Add new modal            document.body.insertAdjacentHTML('beforeend', modalHtml);                        // Show modal            const modal = new bootstrap.Modal(document.getElementById('batchUploadModal'));            modal.show();                        // Setup event listeners            document.getElementById('batchUploadArea').addEventListener('click', function() {                document.getElementById('batchFileInput').click();            });                        document.getElementById('batchFileInput').addEventListener('change', function(e) {                const files = Array.from(e.target.files);                if (files.length > 0) {                    processBatchUpload(files);                }            });        }        // Process batch upload        function processBatchUpload(files) {            const formData = new FormData();            files.forEach(file => {                formData.append('files', file);            });                        const resultsDiv = document.getElementById('batchResults');            resultsDiv.innerHTML = `                <div class="text-center">                    <div class="spinner-border text-primary" role="status">                        <span class="visually-hidden">Processing...</span>                    </div>                    <p class="mt-2">Processing ${files.length} images...</p>                </div>            `;                        fetch('/batch_predict', {                method: 'POST',                body: formData            })            .then(response => response.json())            .then(data => {                if (data.results) {                    displayBatchResults(data.results);                } else {                    resultsDiv.innerHTML = `                        <div class="alert alert-danger">                            <i class="fas fa-exclamation-triangle me-2"></i>                            Error processing batch: ${data.error}                        </div>                    `;                }            })            .catch(error => {                resultsDiv.innerHTML = `                    <div class="alert alert-danger">                        <i class="fas fa-exclamation-triangle me-2"></i>                        Batch processing failed: ${error.message}                    </div>                `;            });        }        // Display batch results        function displayBatchResults(results) {            const resultsDiv = document.getElementById('batchResults');            let html = '<h6 class="mb-3">Batch Results:</h6>';                        results.forEach((result, index) => {                html += `                    <div class="card mb-3">                        <div class="card-body">                            <div class="row">                                <div class="col-md-4">                                    <img src="${result.image_url}" class="img-fluid rounded"                                          alt="${result.filename}" style="max-height: 150px;">                                </div>                                <div class="col-md-8">                                    <h6 class="card-title">${result.filename}</h6>                                    ${result.error ?                                         `<div class="alert alert-danger">Error: ${result.error}</div>` :                                        generatePredictionHtml(result.predictions)                                    }                                </div>                            </div>                        </div>                    </div>                `;            });                        resultsDiv.innerHTML = html;        }        // Generate prediction HTML        function generatePredictionHtml(predictions) {            if (!predictions || predictions.length === 0) {                return '<p class="text-muted">No confident predictions</p>';            }                        let html = '<div class="predictions-list">';            predictions.slice(0, 3).forEach(prediction => {                const confidenceColor = prediction.confidence > 0.8 ? 'success' :                                       prediction.confidence > 0.5 ? 'warning' : 'danger';                                html += `                    <div class="d-flex justify-content-between align-items-center mb-2">                        <span class="fw-bold">${prediction.class}</span>                        <span class="badge bg-${confidenceColor}">${prediction.percentage.toFixed(1)}%</span>                    </div>                `;            });            html += '</div>';                        return html;        }        // Initialize tooltips        document.addEventListener('DOMContentLoaded', function() {            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));            tooltipTriggerList.map(function(tooltipTriggerEl) {                return new bootstrap.Tooltip(tooltipTriggerEl);            });        });    </script></body></html>"""